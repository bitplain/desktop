# SMB root path fix — Design

**Цель:** устранить зависание списка файлов в File Manager при подключении SMB, чтобы папка `video` корректно показывала содержимое шары `\\10.10.1.5\video`.

**Контекст:** при активном SMB `GET /api/filemanager/list?path=` и `?path=video` зависают. В коде `buildRemotePath("video", "")` возвращает `"\\"`, и `smb2.readdir("\\")` может не завершаться. MCP не нашёл документацию по npm-пакету `smb2`, поэтому решение основано на наблюдаемом поведении и минимальной правке.

## Архитектура и поток данных
- UI вызывает `/api/filemanager/list`.
- `getStorageContext` выбирает SMB и маппит путь через `buildRemotePath`.
- `smbProvider.list` вызывает `readdir`.

## Предлагаемое изменение
1) Изменить `buildRemotePath` так, чтобы для корня шары (пустой `subPath` и путь `"video"` или `""`) возвращалась пустая строка, а не `"\\"`.
2) В `smbProvider.list` нормализовать корневой путь перед `readdir`: `"\\"` и `"/"` привести к `""`.
3) Добавить таймаут в `smbCall`, чтобы API не зависал бесконечно (защитная мера, не основная причина).

## Ошибки и поведение
- При таймауте возвращать 500 с понятным сообщением; UI покажет ошибку загрузки.

## Тесты
- Обновить тест `buildRemotePath("video", "")` → ожидается `""`.
- Добавить тест для нормализации корневого пути (или протестировать через вспомогательную утилиту).

## Риски
- Изменение формата путей для SMB корня может повлиять на экзотические SMB реализации; защита таймаутом снижает риск зависаний.
