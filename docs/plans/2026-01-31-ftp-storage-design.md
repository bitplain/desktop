# FTP storage integration — Design

**Цель:** добавить FTP как источник файлов для File Manager. При активном FTP папка `video` должна показывать содержимое `ftp://<host>/<subPath>` (например `ftp://10.10.1.5/video`). В настройках — аккордеон‑секции для SMB и FTP, со статусом и сворачиванием после сохранения.

**Важно:** MCP (context7) не нашёл документации по npm‑клиентам FTP (например, `basic-ftp`). Это нужно явно подтвердить. Реализация будет минимальной и осторожной, либо по предоставленной вами документации.

## Архитектура и данные
- Храним две записи подключения на пользователя: по одной на провайдера (SMB и FTP).
- Добавляем `User.activeStorageProvider` (enum) для явного выбора активного источника.
- Уникальный индекс на `(userId, provider)` вместо `(userId)`.

## API
- `GET /api/storage/connection` → возвращает обе конфигурации (`smb`, `ftp`) + `activeProvider`.
- `POST /api/storage/connection` → принимает `provider` и соответствующие поля; сохраняет запись провайдера и **делает её активной**.
- `DELETE /api/storage/connection?provider=SMB|FTP` → удаляет запись конкретного провайдера. Если удалили активный — сбрасываем `activeProvider`.

## UI (SystemApp)
- Аккордеон из двух секций: SMB и FTP.
- Заголовок секции: название + статус‑точка (зелёная при наличии сохранённой конфигурации).
- Клик по заголовку раскрывает форму; после успешного сохранения секция сворачивается.
- При сохранении провайдера активируем его (без отдельного переключателя).

## FTP провайдер
- Новый `ftpProvider` реализует интерфейс `StorageProvider`.
- Поддержка: list/stat/read/write/createFolder/deleteFile/deleteFolder.
- Маппинг пути: как в SMB — `stripVideoPrefix` + `subPath`.

## Риски
- Без официальной MCP‑документации для выбранной FTP‑библиотеки нужна аккуратная минимальная интеграция.
- Требуется новая зависимость (по правилам — только с вашим явным разрешением).
