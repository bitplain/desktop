# Desktop XP Shell

XP-style desktop shell built with Next.js App Router, NextAuth Credentials, and Prisma/Postgres.

## Setup flow

1. Start the app (see Docker or Local Dev below).
2. Visit `/setup` to provide DB host/port/user/password and create the first admin.
3. Create invite codes as admin via `POST /api/invites`.
4. Register users at `/register` using an invite code, then log in at `/login`.

Notes:
- Runtime config is stored at `/data/config.json` (override base path with `DATA_DIR`).
- Config storage is encrypted; set `CONFIG_ENCRYPTION_KEY` for setup/read.
- Secrets are generated automatically during setup.
- The database name is fixed to `desktop`.
- Invites expire after 12 hours and are single-use.

## Docker

```bash
docker compose up --build
```

Then follow the setup flow at `http://localhost:3000`.

## Local development

```bash
npm install
npm run dev
```

If you prefer env vars over `/data/config.json`, set:

- `DATABASE_URL`
- `NEXTAUTH_SECRET`
- `KEYS_ENCRYPTION_SECRET`
- `CONFIG_ENCRYPTION_KEY` (only required when using `/data/config.json`)

## Prisma

Schema lives in `prisma/schema.prisma`. If you are running locally, create migrations as needed:

```bash
npx prisma migrate dev --name init
```

## Modules

Core modules live under `src/modules/core/*/`:

- `manifest.ts` (metadata: `id`, `title`, `subtitle`, `icon`, `desktopIcon`, `startMenu`, `defaultOpen`)
- `window.tsx` (lazy-loaded window component)

The registry is generated by `scripts/generate-modules-registry.mjs` and runs on `predev`/`prebuild`.

## Assets

XP assets live in:

- `public/wallpapers`
- `public/sounds`
- `public/icons/xp`
- `public/cursors`
